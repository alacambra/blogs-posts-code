= JMS basics
:source-highlighter: coderay

[source,java]
.get a jms context
----
  @Inject
  @JMSConnectionFactory("java:/ConnectionFactory")
  JMSContext context;
----

[source,java]
//TODO: look how jndi name should look like on jboss
.get a queue
----
  @Resource(lookup = "java:global/jms/queueName")
  Queue myQueue;
----

[source,java]
.Declare an async listener for incomming messages
----
@MessageDriven(name = "HelloWorldQueueMDB", activationConfig = {
    @ActivationConfigProperty(propertyName = "destinationLookup", propertyValue = "java:global/jms/queueName"),
    @ActivationConfigProperty(propertyName = "destinationType", propertyValue = "javax.jms.Queue"),
    @ActivationConfigProperty(propertyName = "acknowledgeMode", propertyValue = "Auto-acknowledge")})
public class AsyncConsumer implements MessageListener {

  private static final Logger LOGGER = Logger.getLogger(AsyncConsumer.class.toString());

  public void onMessage(Message recivedMessage) {
    //Do something
  }
}
----

[source,java]
.Declare an async listener for incoming messages
----
@JMSPasswordCredential(userName = "userName", password = "password")
----


== Jboss specific
.Configuration on standalone-full.xml
[source,xml]
----
<subsystem xmlns="urn:jboss:domain:messaging-activemq:7.0">
            <server name="default">
                <statistics enabled="${wildfly.messaging-activemq.statistics-enabled:${wildfly.statistics-enabled:false}}"/>
                <security-setting name="#">
                    <role name="guest" send="true" consume="true" create-non-durable-queue="true" delete-non-durable-queue="true"/>
                </security-setting>
                <address-setting name="#" dead-letter-address="jms.queue.DLQ" expiry-address="jms.queue.ExpiryQueue" max-size-bytes="10485760" page-size-bytes="2097152" message-counter-history-day-limit="10"/>
                <http-connector name="http-connector" socket-binding="http" endpoint="http-acceptor"/>
                <http-connector name="http-connector-throughput" socket-binding="http" endpoint="http-acceptor-throughput">
                    <param name="batch-delay" value="50"/>
                </http-connector>
                <in-vm-connector name="in-vm" server-id="0">
                    <param name="buffer-pooling" value="false"/>
                </in-vm-connector>
                <http-acceptor name="http-acceptor" http-listener="default"/>
                <http-acceptor name="http-acceptor-throughput" http-listener="default">
                    <param name="batch-delay" value="50"/>
                    <param name="direct-deliver" value="false"/>
                </http-acceptor>
                <in-vm-acceptor name="in-vm" server-id="0">
                    <param name="buffer-pooling" value="false"/>
                </in-vm-acceptor>
                <jms-queue name="ExpiryQueue" entries="java:/jms/queue/ExpiryQueue"/>
                <jms-queue name="DLQ" entries="java:/jms/queue/DLQ"/>
                <connection-factory name="InVmConnectionFactory" entries="java:/ConnectionFactory" connectors="in-vm"/>
                <connection-factory name="RemoteConnectionFactory" entries="java:jboss/exported/jms/RemoteConnectionFactory" connectors="http-connector"/>
                <pooled-connection-factory name="activemq-ra" entries="java:/JmsXA java:jboss/DefaultJMSConnectionFactory" connectors="in-vm" transaction="xa"/>
            </server>
        </subsystem>
----

The role element defines the rule a user must have.
.Configuration of allowd user roles
[source,xml]
----
<role name="guest" send="true" consume="true" create-non-durable-queue="true" delete-non-durable-queue="true"/>
----
Per default, when using java:jboss/exported/jms/RemoteConnectionFactory, the ApplicationRealm security realm is used. Actually is taken from the http-connector:
[source,xml]
----
<subsystem xmlns="urn:jboss:domain:messaging-activemq:7.0">
........
    <connection-factory name="RemoteConnectionFactory" entries="java:jboss/exported/jms/RemoteConnectionFactory" connectors="http-connector"/>
    <http-connector name="http-connector" socket-binding="http" endpoint="http-acceptor"/>
........
</subsystem>
----

[source,xml]
----
<subsystem xmlns="urn:jboss:domain:remoting:4.0">
    <http-connector name="http-remoting-connector" connector-ref="default" security-realm="ApplicationRealm"/>
</subsystem>
----